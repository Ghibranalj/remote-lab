events {
  worker_connections  4096;  ## Default: 1024
}

http{
	server {
		listen 80 default_server;
		listen [::]:80 default_server;

		# SSL configuration
		#
		# listen 443 ssl default_server;
		# listen [::]:443 ssl default_server;
		#
		# Note: You should disable gzip for SSL traffic.
		# See: https://bugs.debian.org/773332
		#
		# Read up on ssl_ciphers to ensure a secure configuration.
		# See: https://bugs.debian.org/765782
		#
		# Self signed certs generated by the ssl-cert package
		# Don't use them in a production server!
		#
		# include snippets/snakeoil.conf;

		root /var/www/html;

		server_name _;

		location  / {
			proxy_pass  http://localhost:3080/;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Host $http_host;
			proxy_set_header X-NginX-Proxy true;

			proxy_redirect off;

			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
		}

		location  /komputer/ {
			proxy_pass http://localhost:8000/;
			proxy_set_header Host $host;
		}
		location /novnc/ {
			proxy_pass http://127.0.0.1:6080/;
		}
		location /novnc/websockify {
			proxy_pass http://127.0.0.1:6080/;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "Upgrade";
			proxy_set_header Host $host;
			# Don't disconnect if inactive.
			proxy_read_timeout 600s;
			# Disable caching of VNC stream.
			proxy_buffering off;
		}
	}
}
